    
    
    
    

    

    \hypertarget{caractuxe8res-accentuuxe9s}{%
\section{Caract√®res accentu√©s}\label{caractuxe8res-accentuuxe9s}}

    Ce compl√©ment expose quelques bases concernant les caract√®res accentu√©s,
et notamment les pr√©cautions √† prendre pour pouvoir en ins√©rer dans un
programme Python. Nous allons voir que cette question, assez scabreuse,
d√©passe tr√®s largement le cadre de Python.

    \hypertarget{compluxe9ment---niveau-basique}{%
\subsection{Compl√©ment - niveau
basique}\label{compluxe9ment---niveau-basique}}

    \hypertarget{un-caractuxe8re-nest-pas-un-octet}{%
\subparagraph{Un caract√®re n'est pas un
octet}\label{un-caractuxe8re-nest-pas-un-octet}}

    Avec Unicode, on a cass√© le mod√®le \emph{un caract√®re} == \emph{un
octet}. Aussi en Python 3, lorsqu'il s'agit de manipuler des donn√©es
provenant de diverses sources de donn√©es~:

\begin{itemize}
\tightlist
\item
  le type \texttt{byte} est appropri√© si vous voulez charger en m√©moire
  les donn√©es binaires brutes, sous forme d'octets donc~;
\item
  le type \texttt{str} est appropri√© pour repr√©senter une cha√Æne de
  caract√®res - qui, √† nouveau ne sont pas forc√©ment des octets~;
\item
  on passe de l'un √† l'autre de ces types par des op√©rations d'encodage
  et d√©codage, comme illustr√© ci-dessous~;
\item
  et pour \textbf{toutes} les op√©rations d'encodage et d√©codage, il est
  n√©cessaire de conna√Ætre l'encodage utilis√©.
\end{itemize}

    \begin{figure}
\centering
\includegraphics{media/str-bytes.png}
\caption{les types bytes et str}
\end{figure}

    On peut appeler les m√©thodes \texttt{encode} et \texttt{decode} sans
pr√©ciser l'encodage (dans ce cas Python choisit l'encodage par d√©faut
sur votre syst√®me). Cela dit, il est de loin pr√©f√©rable d'√™tre explicite
et de choisir son encodage. En cas de doute, il est recommand√© de
\textbf{sp√©cifier explicitement} \texttt{utf-8}, qui se g√©n√©ralise au
d√©triment d'encodages anciens comme \texttt{cp1242} (Windows) et
\texttt{iso8859-*}, que de laisser le syst√®me h√¥te choisir pour vous.

    \hypertarget{utilisation-des-accents-et-autres-cuxe9dilles}{%
\subparagraph{Utilisation des accents et autres
c√©dilles}\label{utilisation-des-accents-et-autres-cuxe9dilles}}

    Python 3 supporte Unicode par d√©faut. Vous pouvez donc, maintenant,
utiliser sans aucun risque des accents ou des c√©dilles dans vos cha√Ænes
de caract√®res. Il faut cependant faire attention √† deux choses~:

\begin{itemize}
\tightlist
\item
  Python supporte Unicode, donc tous les caract√®res du monde, mais les
  ordinateurs n'ont pas forc√©ment les polices de caract√®res n√©cessaires
  pour afficher ces caract√®res~;
\item
  Python permet d'utiliser des caract√®res Unicode pour les noms de
  variables, mais nous vous recommandons dans toute la mesure du
  possible d'√©crire votre code en anglais, comme c'est le cas pour la
  quasi-totalit√© du code que vous serez amen√©s √† utiliser sous forme de
  biblioth√®ques. Ceci est particuli√®rement important pour les noms de
  lignes et de colonnes dans un dataset afin de faciliter les transferts
  entre logiciels, la majorit√© des logiciels n'acceptant pas les accents
  et c√©dilles dans les noms de variables.
\end{itemize}

Ainsi, il faut bien distinguer les cha√Ænes de caract√®res qui doivent par
nature √™tre adapt√©es au langage des utilisateurs du programme, et le
code source qui lui est destin√© aux programmeurs et qui doit donc √©viter
d'utiliser autre chose que de l'anglais.

    \hypertarget{compluxe9ment---niveau-intermuxe9diaire}{%
\subsection{Compl√©ment - niveau
interm√©diaire}\label{compluxe9ment---niveau-intermuxe9diaire}}

    \hypertarget{ouxf9-peut-on-mettre-des-accents}{%
\subsubsection{O√π peut-on mettre des
accents~?}\label{ouxf9-peut-on-mettre-des-accents}}

    Cela √©tant dit, si vous devez vraiment mettre des accents dans vos
sources, voici ce qu'il faut savoir.

    \hypertarget{noms-de-variables}{%
\paragraph{Noms de variables}\label{noms-de-variables}}

    \begin{itemize}
\tightlist
\item
  S'il n'√©tait \textbf{pas possible en Python 2} d'utiliser un caract√®re
  accentu√© dans un \textbf{nom de variable} (ou d'un identificateur au
  sens large), cela est √† pr√©sent \textbf{permis en Python 3}~:
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\},frame=single,framerule=0.3mm,rulecolor=\color{cellframecolor}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{c+c1}{\PYZsh{} pas recommand√©, mais autoris√© par le langage}
        \PY{n}{nb\PYZus{}√©l√®ves} \PY{o}{=} \PY{l+m+mi}{12}
\end{Verbatim}


    \begin{itemize}
\tightlist
\item
  On peut m√™me utiliser des symboles, comme par exemple
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\},frame=single,framerule=0.3mm,rulecolor=\color{cellframecolor}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{k+kn}{from} \PY{n+nn}{math} \PY{k}{import} \PY{n}{cos}\PY{p}{,} \PY{n}{pi} \PY{k}{as} \PY{n}{ùûü}
        \PY{n}{Œ∏} \PY{o}{=} \PY{n}{ùûü} \PY{o}{/} \PY{l+m+mi}{4}
        \PY{n}{cos}\PY{p}{(}\PY{n}{Œ∏}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\},frame=single,framerule=0.3mm,rulecolor=\color{cellframecolor}]
{\color{outcolor}Out[{\color{outcolor}2}]:} 0.7071067811865476
\end{Verbatim}
            
    \begin{itemize}
\tightlist
\item
  Je vous recommande toutefois de \textbf{ne pas utiliser} cette
  possibilit√©, si vous n'√™tes pas extr√™mement familier avec les
  caract√®res Unicode.
\end{itemize}

    \begin{itemize}
\tightlist
\item
  Enfin, pour √™tre exhaustif, sachez que seule une partie des caract√®res
  Unicode sont autoris√©s dans ce cadre, c'est heureux parce que les
  caract√®res comme, par exemple,
  \href{http://www.fileformat.info/info/unicode/char/a0/index.htm}{l'espace
  non-s√©cable} pourraient, s'ils √©taient autoris√©s, √™tre la cause de
  milliers d'heures de debugging √† frustration garantie :)
\end{itemize}

Pour les curieux, vous pouvez en savoir plus
\href{https://docs.python.org/3/reference/lexical_analysis.html\#identifiers}{√†
cet endroit de la documentation officielle (en anglais)}.

    \hypertarget{chauxeenes-de-caractuxe8res}{%
\paragraph{Cha√Ænes de caract√®res}\label{chauxeenes-de-caractuxe8res}}

    \begin{itemize}
\item
  Vous pouvez naturellement mettre des accents dans les cha√Ænes de
  caract√®res. Cela dit, les donn√©es manipul√©es par un programme
  proviennent pour l'essentiel de sources externes, comme une base de
  donn√©es ou un formulaire Web, et donc le plus souvent pas directement
  du code source. Les cha√Ænes de caract√®res pr√©sentes dans du vrai code
  sont bien souvent limit√©es √† des messages de logging, et le plus
  souvent d'ailleurs en anglais, donc sans accent.
\item
  Lorsque votre programme doit interagir avec les utilisateurs et qu'il
  doit donc parler leur langue, c'est une bonne pratique de cr√©er un
  fichier sp√©cifique, que l'on appelle fichier de ressources, qui
  contient toutes les cha√Ænes de caract√®res sp√©cifiques √† une langue.
  Ainsi, la traduction de votre programme consistera √† simplement
  traduire ce fichier de ressources.
\end{itemize}

    \begin{Shaded}
\begin{Highlighting}[frame=lines,framerule=0.6mm,rulecolor=\color{asisframecolor}]
\NormalTok{message }\OperatorTok{=} \StringTok{"on peut mettre un caract√®re accentu√© dans une cha√Æne"}
\end{Highlighting}
\end{Shaded}

    \hypertarget{commentaires}{%
\paragraph{Commentaires}\label{commentaires}}

    \begin{itemize}
\tightlist
\item
  Enfin on peut aussi bien s√ªr mettre dans les commentaires n'importe
  quel caract√®re Unicode, et donc notamment des caract√®res accentu√©s si
  on choisit malgr√© tout d'√©crire le code en fran√ßais.
\end{itemize}

    \begin{Shaded}
\begin{Highlighting}[frame=lines,framerule=0.6mm,rulecolor=\color{asisframecolor}]
\CommentTok{# on peut mettre un caract√®re accentu√© dans un commentaire}
\CommentTok{# ainsi que cos(Œò), ‚àÄx ‚àà ‚à´f(t)dt vous voyez l'id√©e g√©n√©rale}
\end{Highlighting}
\end{Shaded}

    \hypertarget{quest-ce-quun-encodage}{%
\subsubsection{Qu'est-ce qu'un
encodage~?}\label{quest-ce-quun-encodage}}

    Comme vous le savez, la m√©moire - ou le disque - d'un ordinateur ne
permet que de stocker des repr√©sentations binaires. Il n'y a donc pas de
fa√ßon ``naturelle'' de repr√©senter un caract√®re comme `A', un guillemet
ou un point-virgule.

On utilise pour cela un encodage, par exemple
\href{http://www.asciitable.com/}{le code \texttt{US-ASCII}} stipule,
pour faire simple, qu'un `A' est repr√©sent√© par l'octet 65 qui s'√©crit
en binaire 01000001. Il se trouve qu'il existe plusieurs encodages, bien
s√ªr incompatibles, selon les syst√®mes et les langues. Vous trouverez
plus de d√©tails ci-dessous.

Le point important est que pour pouvoir ouvrir un fichier
``proprement'', il faut bien entendu disposer du \textbf{contenu} du
fichier, mais il faut aussi conna√Ætre l'\textbf{encodage} qui a √©t√©
utilis√© pour l'√©crire.

    \hypertarget{pruxe9cautions-uxe0-prendre-pour-lencodage-de-votre-code-source}{%
\subsubsection{Pr√©cautions √† prendre pour l'encodage de votre code
source}\label{pruxe9cautions-uxe0-prendre-pour-lencodage-de-votre-code-source}}

    L'encodage ne concerne pas simplement les objets cha√Æne de caract√®res,
mais √©galement votre code source. \textbf{Python 3} consid√®re que votre
code source utilise \textbf{par d√©faut l'encodage \texttt{UTF-8}}. Nous
vous conseillons de conserver cet encodage qui est celui qui vous
offrira le plus de flexibilit√©.

    Vous pouvez malgr√© tout changer l'encodage \textbf{de votre code source}
en faisant figurer dans vos fichiers, \textbf{en premi√®re ou deuxi√®me
ligne}, une d√©claration comme ceci~:

\begin{Shaded}
\begin{Highlighting}[frame=lines,framerule=0.6mm,rulecolor=\color{asisframecolor}]
\CommentTok{# -*- coding: <nom_de_l_encodage> -*-}
\end{Highlighting}
\end{Shaded}

ou plus simplement, comme ceci~:

\begin{Shaded}
\begin{Highlighting}[frame=lines,framerule=0.6mm,rulecolor=\color{asisframecolor}]
\CommentTok{# coding: <nom_de_l_encodage>}
\end{Highlighting}
\end{Shaded}

Notons que la premi√®re option est √©galement interpr√©t√©e par l'√©diteur de
texte \emph{Emacs} pour utiliser le m√™me encodage. En dehors de
l'utilisation d'Emacs, la deuxi√®me option, plus simple et donc plus
pythonique, est √† pr√©f√©rer.

    Le nom \textbf{\texttt{UTF-8}} fait r√©f√©rence √† \textbf{Unicode} (ou
pour √™tre pr√©cis, √† l'encodage le plus r√©pandu parmi ceux qui sont
d√©finis dans la norme Unicode, comme nous le verrons plus bas). Sur
certains syst√®mes plus anciens vous pourrez √™tre amen√©s √† utiliser un
autre encodage. Pour d√©terminer la valeur √† utiliser dans votre cas
pr√©cis vous pouvez faire dans l'interpr√©teur interactif~:

    \begin{Shaded}
\begin{Highlighting}[frame=lines,framerule=0.6mm,rulecolor=\color{asisframecolor}]
\CommentTok{# ceci doit √™tre ex√©cut√© sur votre machine}
\ImportTok{import}\NormalTok{ sys}
\BuiltInTok{print}\NormalTok{(sys.getdefaultencoding())}
\end{Highlighting}
\end{Shaded}

    Par exemple avec d'anciennes versions de Windows (en principe de plus en
plus rares) vous pouvez √™tre amen√©s √† √©crire~:

    \begin{Shaded}
\begin{Highlighting}[frame=lines,framerule=0.6mm,rulecolor=\color{asisframecolor}]
\CommentTok{# coding: cp1252}
\end{Highlighting}
\end{Shaded}

    La syntaxe de la ligne \texttt{coding} est pr√©cis√©e dans
\href{https://docs.python.org/3/reference/lexical_analysis.html\#encoding-declarations}{cette
documentation} et dans le
\href{https://www.python.org/dev/peps/pep-0263/}{PEP 263}.

    \hypertarget{le-grand-malentendu}{%
\subsubsection{Le grand malentendu}\label{le-grand-malentendu}}

    Si je vous envoie un fichier contenant du fran√ßais encod√© avec, disons,
\href{http://en.wikipedia.org/wiki/ISO/IEC_8859-15}{ISO/IEC 8859-15 -
a.k.a. \texttt{Latin-9}}; vous pouvez voir dans la table qu'un caract√®re
`‚Ç¨' va √™tre mat√©rialis√© dans mon fichier par un octet `0xA4', soit 164.

Imaginez maintenant que vous essayez d'ouvrir ce m√™me fichier depuis un
vieil ordinateur Windows configur√© pour le fran√ßais. Si on ne lui donne
aucune indication sur l'encodage, le programme qui va lire ce fichier
sur Windows va utiliser l'encodage par d√©faut du syst√®me, c'est-√†-dire
\href{http://en.wikipedia.org/wiki/Windows-1252}{CP1252}. Comme vous le
voyez dans cette table, l'octet `0xA4' correspond au caract√®re
\includegraphics{media/currency-sign.png} et c'est √ßa que vous allez
voir √† la place de ‚Ç¨.

Contrairement √† ce qu'on pourrait esp√©rer, ce type de probl√®me ne peut
pas se r√©gler en ajoutant une balise
\texttt{\#\ coding:\ \textless{}nom\_de\_l\_encodage\textgreater{}}, qui
n'agit que sur l'encodage utilis√© \emph{pour lire le fichier source en
question} (celui qui contient la balise).

Pour r√©gler correctement ce type de probl√®me, il vous faut pr√©ciser
explicitement l'encodage √† utiliser pour d√©coder le fichier. Et donc
avoir un moyen fiable de d√©terminer cet encodage; ce qui n'est pas
toujours ais√© d'ailleurs, mais c'est une autre discussion
malheureusement. Ce qui signifie que pour √™tre totalement propre, il
faut pouvoir pr√©ciser explicitement le param√®tre \texttt{encoding} √†
l'appel de toutes les m√©thodes qui sont susceptibles d'en avoir besoin.

    \hypertarget{pourquoi-uxe7a-marche-en-local}{%
\subsubsection{Pourquoi √ßa marche en
local~?}\label{pourquoi-uxe7a-marche-en-local}}

    Lorsque le producteur (le programme qui √©crit le fichier) et le
consommateur (le programme qui le lit) tournent dans le m√™me ordinateur,
tout fonctionne bien - en g√©n√©ral - parce que les deux programmes se
ram√®nent √† l'encodage d√©fini comme l'encodage par d√©faut.

Il y a toutefois une limite, si vous utilisez un Linux configur√© de
mani√®re minimale, il se peut qu'il utilise par d√©faut l'encodage
\texttt{US-ASCII} - voir plus bas - qui √©tant tr√®s ancien ne ``conna√Æt''
pas un simple √©, ni a fortiori ‚Ç¨. Pour √©crire du fran√ßais, il faut donc
au minimum que l'encodage par d√©faut de votre ordinateur contienne les
caract√®res fran√ßais, comme par exemple~:

\begin{itemize}
\tightlist
\item
  \texttt{ISO\ 8859-1} (\texttt{Latin-1})
\item
  \texttt{ISO\ 8859-15} (\texttt{Latin-9})
\item
  \texttt{UTF-8}
\item
  \texttt{CP1252}
\end{itemize}

√Ä nouveau dans cette liste, il faut clairement pr√©f√©rer UTF-8 lorsque
c'est possible.

    \hypertarget{un-peu-dhistoire-sur-les-encodages}{%
\subsubsection{Un peu d'histoire sur les
encodages}\label{un-peu-dhistoire-sur-les-encodages}}

    \hypertarget{le-code-us-ascii}{%
\subparagraph{\texorpdfstring{Le code
\texttt{US-ASCII}}{Le code US-ASCII}}\label{le-code-us-ascii}}

    Jusque dans les ann√©es 1980, les ordinateurs ne parlaient pour
l'essentiel que l'anglais. La premi√®re vague de standardisation avait
cr√©√© l'encodage dit \texttt{ASCII}, ou encore \texttt{US-ASCII}
\href{http://www.asciitable.com}{voir par exemple ici}, ou encore
\href{http://en.wikipedia.org/wiki/ASCII}{en version longue ici}.

Le code \texttt{US-ASCII} s'√©tend sur 128 valeurs, soit 7 bits, mais est
le plus souvent impl√©ment√© sur un octet pour pr√©server l'alignement, le
dernier bit pouvant √™tre utilis√© par exemple pour ajouter un code
correcteur d'erreur - ce qui √† l'√©poque des modems n'√©tait pas superflu.
Bref, la pratique courante √©tait alors de manipuler une cha√Æne de
caract√®res comme un tableau d'octets.

    \hypertarget{les-encodages-iso8859--latin}{%
\subparagraph{\texorpdfstring{Les encodages \texttt{ISO8859-*}
(\texttt{Latin*})}{Les encodages ISO8859-* (Latin*)}}\label{les-encodages-iso8859--latin}}

    Dans les ann√©es 1990, pour satisfaire les besoins des pays europ√©ens,
ont √©t√© d√©finis plusieurs encodages alternatifs, connus sous le nom de
\href{http://en.wikipedia.org/wiki/ISO/IEC_8859}{\texttt{ISO/IEC\ 8859-*}},
nomm√©s aussi \texttt{Latin-*}. Id√©alement, on aurait pu et
\textbf{certainement d√ª} d√©finir un seul encodage pour repr√©senter tous
les nouveaux caract√®res, mais entre toutes les langues europ√©ennes, le
nombre de caract√®res √† ajouter √©tait substantiel, et cet encodage unifi√©
aurait largement d√©pass√© 256 caract√®res diff√©rents, il n'aurait donc
\textbf{pas √©t√© possible} de tout faire tenir sur un octet.

On a pr√©f√©r√© pr√©server la ``bonne propri√©t√©'' du mod√®le \emph{un
caract√®re} == \emph{un octet}, ceci afin de pr√©server le code existant
qui aurait sinon d√ª √™tre retouch√© ou r√©√©crit.

D√®s lors il n'y avait pas d'autre choix que de d√©finir
\textbf{plusieurs} encodages distincts, par exemple, pour le fran√ßais on
a utilis√© √† l'√©poque
\href{http://en.wikipedia.org/wiki/ISO/IEC_8859-1}{\texttt{ISO/IEC\ 8859-1}
(\texttt{Latin-1})}, pour le russe
\href{http://en.wikipedia.org/wiki/ISO/IEC_8859-5}{\texttt{ISO/IEC\ 5589-5}
(\texttt{Latin/Cyrillic})}.

√Ä ce stade, le ver √©tait dans le fruit. Depuis cette √©poque pour ouvrir
un fichier il faut conna√Ætre son encodage.

    \hypertarget{unicode}{%
\subparagraph{Unicode}\label{unicode}}

    Lorsque l'on a ensuite cherch√© √† manipuler aussi les langues asiatiques,
il a de toute fa√ßon fallu d√©finir de nouveaux encodages beaucoup plus
larges. C'est ce qui a √©t√© fait par le standard
\href{http://en.wikipedia.org/wiki/Unicode}{Unicode} qui d√©finit 3
nouveaux encodages~:

\begin{itemize}
\tightlist
\item
  \href{http://en.wikipedia.org/wiki/UTF-8}{\texttt{UTF-8}} : un
  encodage √† taille variable, √† base d'octets, qui maximise la
  compatibilit√© avec US-ASCII~;
\item
  \href{http://en.wikipedia.org/wiki/UTF-16}{\texttt{UTF-16}} : un
  encodage √† taille variable, √† base de mots de 16 bits~;
\item
  \href{http://en.wikipedia.org/wiki/UTF-32}{\texttt{UTF-32}} : un
  encodage √† taille fixe, √† base de mots de 32 bits~;
\end{itemize}

Ces 3 standards couvrent le m√™me jeu de caract√®res (113 021 tout de m√™me
dans la derni√®re version). Parmi ceux-ci le plus utilis√© est
certainement \texttt{UTF-8}. Un texte ne contenant que des caract√®res du
code \texttt{US-ASCII} initial peut √™tre lu avec l'encodage
\texttt{UTF-8}.

Pour √™tre enfin tout √† fait exhaustif, si on sait qu'un fichier est au
format Unicode, on peut d√©terminer quel est l'encodage qu'il utilise, en
se basant sur les 4 premiers octets du document. Ainsi dans ce cas
particulier (lorsqu'on est s√ªr qu'un document utilise un des trois
encodages Unicode) il n'est plus n√©cessaire de conna√Ætre son encodage de
mani√®re ``externe''.


    % Add a bibliography block to the postdoc
    
    
    
